<!DOCTYPE html>
<html>

<head>
<title>修改年级组信息</title>
<link rel="stylesheet" href="/plugin/layui/css/layui.css" />
<script src="/plugin/layui/layui.all.js"></script>
<script src="/plugin/jquery/jquery.js"></script>
<script src="/plugin/jquery/jquery.serializejson.js"></script>
<script src="/plugin/jsrender/jsrender.js"></script>
</head>

<body>
  <div class="layui-container" style="margin:30px;">
    <form class="layui-form layui-form-pane" id="group" method="post">
      <!-- 隐藏年级组ID -->        
          <input class="layui-input" name="groupId" id="groupId" type="hidden" />       
      <div class="layui-form-item">
        <label class="layui-form-label">入学年份:</label>
        <div class="layui-input-block">
          <input type="text" class="layui-input" name="year" id="year" placeholder="yyyy">
        </div>
      </div>
      <div class="layui-form-item" pane="">
        <label class="layui-form-label">学期:</label>
        <div class="layui-input-block">
          <input type="radio" name="semester" id="semester" value="0" title="上学期" checked="">
      	  <input type="radio" name="semester" id="semester" value="1" title="下学期"> 
        </div>
      </div>
      <div class="layui-form-item" pane="">
        <label class="layui-form-label">初/高中:</label>
        <div class="layui-input-block">
          <input type="radio" name="level" id="level" value="0" title="初中" checked="">
      	  <input type="radio" name="level" id="level" value="1" title="高中">          
        </div>
      </div>
      <div class="layui-form-item" pane="">
        <label class="layui-form-label">年级:</label>
        <div class="layui-input-block">
          <input type="radio" name="exam" id="exam" value="0" title="一" checked="">
      	  <input type="radio" name="exam" id="exam" value="1" title="二">
      	  <input type="radio" name="exam" id="exam" value="2" title="三">
        </div>
      </div>
      <div class="layui-form-item">
        <label class="layui-form-label">起始日期:</label>
        <div class="layui-input-block">
          <input type="text" class="layui-input" name="startDate" id="startDate" placeholder="yyyy-MM-dd">
        </div>
      </div>
      <div class="layui-form-item">
        <div class="layui-input-block">
          <button class="layui-btn" type="button" onclick="modify()">保存</button>
          <button class="layui-btn" type="button" onclick="cancel()">取消</button>
        </div>
      </div>
    </form>
  </div>  
  <script>
    $(document).ready(function() {
      var groupId = sessionStorage.getItem('currentGroupId');
      $('#groupId').attr('value', groupId);
      $.ajax({
        async : false,
        type : 'GET',
        url : '/group/find/' + groupId,
        success : function(group) {
          $('#year').attr('value', group.year);
          $(":radio[name='semester'][value='"+group.semester+"']").prop("checked","checked");
          $(":radio[name='level'][value='"+group.level+"']").prop("checked","checked");
          $(":radio[name='exam'][value='"+group.exam+"']").prop("checked","checked","checked");
          $('#startDate').attr('value', group.startDate);
        }
      });
      layui.use('form', function() {
        layui.form.render();
      });
      layui.use('laydate', function(){
        layui.laydate.render({
          elem : '#startDate'
          ,ready: function(date){
            console.log(date);
          }
        });
        layui.laydate.render({
          elem: '#year'
          ,type: 'year'
          ,change: function(value){            
            $('.layui-laydate-content').click(function(){              
              if($(this).attr('class') == 'layui-laydate-content'){
                $('#year').attr('value',value);
                $('.layui-laydate').remove(0);
              }
            })          
          }
        });
      });      
    });
  
  
    function modify() {
      $.ajax({
        async : false,//同步请求（锁住浏览器，请求完毕后才可执行其他操作），true为异步请求
        url : '/group/modify',//请求url
        type : 'POST',
        dataType : 'json',//预期服务器返回的数据类型
        contentType : 'application/json',//发送信息至服务器时内容编码类型
        data : JSON.stringify($('#group').serializeJSON()),//发送到服务器的数据类型,序列化表格内容为字符串
        success : function(result) {//请求成功后回调函数。这个方法有两个参数：服务器返回数据，返回状态
          var index = parent.layer.getFrameIndex(window.name);//获取当前界面的url
          parent.layer.close(index);//关闭当前界面
          parent.list();// 调用该界面的父界面的函数  即 调用list.html中的list()函数
        }
      });
    }
  
    
    function cancel() {
      var index = parent.layer.getFrameIndex(window.name);
      parent.layer.close(index);
    }
  </script>
</body>
</html>
